{"version":3,"file":"vue-router-plus.js","sources":["../src/utils.js","../src/before/query-options.js","../src/vue-router-plus.js"],"sourcesContent":["export const isString = s => typeof s === 'string'\n\nexport const cloneDeep = s => JSON.parse(JSON.stringify(s))\n","import { cloneDeep } from '../utils'\nexport default (to, from, next) => {\n  if ('_f' in to.query) {\n    delete to.query['_f']\n  }\n  const queryOptions = to.meta.queryOptions\n  const formatedQuery = cloneDeep(to.query)\n  if (queryOptions) {\n    for (let queryName in queryOptions) {\n      const query = queryOptions[queryName]\n      const queryType = query.type\n      const queryDefaultValue = query.default\n      if (queryName in to.query && to.query[queryName] !== undefined) {\n        formatedQuery[queryName] = queryType(to.query[queryName])\n      } else {\n        formatedQuery[queryName] = queryDefaultValue\n      }\n    }\n  }\n  to.meta.query = formatedQuery\n  console.log(formatedQuery)\n  Object.defineProperty(to, 'query', formatedQuery)\n  next()\n}\n","import VueRouter from 'vue-router'\nimport queryOptions from './before/query-options'\nimport { isString, cloneDeep } from './utils'\n\nlet isHistoryBF = false\n\nclass VueRouterPlus extends VueRouter {\n  static install(Vue) {\n    Vue.use(VueRouter)\n    window.addEventListener('popstate', () => {\n      isHistoryBF = true\n    })\n  }\n  constructor(routeOptions) {\n    super(routeOptions)\n    this.beforeEach(queryOptions)\n    this._forceCount = 1\n  }\n  get isHistoryBF() {\n    return isHistoryBF\n  }\n  _goto(mode, location, onComplete, onError) {\n    isHistoryBF = false\n    if (isString(location)) {\n      super[mode](location, onComplete, onError)\n      return\n    }\n    if (!location.force) {\n      super[mode](location, onComplete, onError)\n      return\n    }\n\n    location.query = location.query || {}\n\n    const toLocation = cloneDeep(location)\n    toLocation.query._f = this._forceCount++\n\n    if (mode === 'push') {\n      // keep _f query\n      super[mode](toLocation, onComplete, onError)\n    }\n    if (mode === 'replace') {\n      const oriLocation = cloneDeep(location)\n      oriLocation.query._f = undefined\n      const oriHref = this.resolve(oriLocation).href\n      super[mode](\n        toLocation,\n        () => {\n          setTimeout(() => {\n            window.history.replaceState(null, null, oriHref)\n            onComplete && onComplete()\n          })\n        },\n        onError\n      )\n    }\n  }\n  push(location, onComplete, onError) {\n    this._goto('push', location, onComplete, onError)\n  }\n  replace(location, onComplete, onError) {\n    this._goto('replace', location, onComplete, onError)\n  }\n  // spa reload current Route and force get Data again\n  reload(onComplete, onError) {\n    const current = this.currentRoute\n    this.replace(\n      {\n        path: current.path,\n        query: current.query,\n        params: current.params,\n        hash: current.hash,\n        force: true\n      },\n      onComplete,\n      onError\n    )\n  }\n}\n\nexport default VueRouterPlus\n"],"names":["cloneDeep","s","JSON","parse","stringify","to","from","next","query","queryOptions","meta","formatedQuery","queryName","queryType","type","queryDefaultValue","undefined","console","log","Object","defineProperty","isHistoryBF","routeOptions","beforeEach","_forceCount","VueRouter","Vue","use","window","addEventListener","mode","location","onComplete","onError","force","toLocation","_f","this","oriLocation","oriHref","resolve","href","setTimeout","history","replaceState","_goto","current","currentRoute","replace","path","params","hash"],"mappings":";;;qsCAAO,IAEMA,EAAY,SAAAC,UAAKC,KAAKC,MAAMD,KAAKE,UAAUH,gBCDxCI,EAAIC,EAAMC,GACpB,OAAQF,EAAGG,cACNH,EAAGG,MAAH,OAEHC,EAAeJ,EAAGK,KAAKD,aACvBE,EAAgBX,EAAUK,EAAGG,UAC/BC,MACG,IAAIG,KAAaH,EAAc,KAC5BD,EAAQC,EAAaG,GACrBC,EAAYL,EAAMM,KAClBC,EAAoBP,UACtBI,KAAaP,EAAGG,YAAiCQ,IAAxBX,EAAGG,MAAMI,GACpCD,EAAcC,GAAaC,EAAUR,EAAGG,MAAMI,IAE9CD,EAAcC,GAAaG,EAIjCV,EAAGK,KAAKF,MAAQG,EAChBM,QAAQC,IAAIP,GACZQ,OAAOC,eAAef,EAAI,QAASM,GACnCJ,KClBEc,GAAc;;8BASJC,8IACJA,KACDC,WAAWd,KACXe,YAAc,gPAVKC,2CACXC,GACbA,EAAIC,IAAIF,GACRG,OAAOC,iBAAiB,WAAY,WAClCR,GAAc,yCAWZS,EAAMC,EAAUC,EAAYC,MAChCZ,GAAc,EFtBwB,iBEuBzBU,KAIRA,EAASG,OAKdH,EAASvB,MAAQuB,EAASvB,OAAS,OAE7B2B,EAAanC,EAAU+B,MAC7BI,EAAW3B,MAAM4B,GAAKC,KAAKb,cAEd,SAATM,oBAEIA,kBAAMK,EAAYH,EAAYC,GAEzB,YAATH,EAAoB,KAChBQ,EAActC,EAAU+B,GAC9BO,EAAY9B,MAAM4B,QAAKpB,MACjBuB,EAAUF,KAAKG,QAAQF,GAAaG,sBACpCX,kBACJK,EACA,WACEO,WAAW,WACTd,OAAOe,QAAQC,aAAa,KAAM,KAAML,GACxCP,GAAcA,OAGlBC,0BAzBIH,kBAAMC,EAAUC,EAAYC,yBAJ5BH,kBAAMC,EAAUC,EAAYC,gCAiCjCF,EAAUC,EAAYC,QACpBY,MAAM,OAAQd,EAAUC,EAAYC,mCAEnCF,EAAUC,EAAYC,QACvBY,MAAM,UAAWd,EAAUC,EAAYC,kCAGvCD,EAAYC,OACXa,EAAUT,KAAKU,kBAChBC,QACH,CACEC,KAAMH,EAAQG,KACdzC,MAAOsC,EAAQtC,MACf0C,OAAQJ,EAAQI,OAChBC,KAAML,EAAQK,KACdjB,OAAO,GAETF,EACAC,8CAxDKZ"}