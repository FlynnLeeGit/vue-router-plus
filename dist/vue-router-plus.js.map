{"version":3,"file":"vue-router-plus.js","sources":["../src/utils.js","../src/before/query-options.js","../src/vue-router-plus.js"],"sourcesContent":["export const cloneDeep = s => JSON.parse(JSON.stringify(s))\n\nexport const hookWrapper = fn =>\n  function(to, from, next) {\n    // use orginal context\n    const ret = fn.call(this, to, from, next)\n    // 形参大于2个\n    if (fn.length > 2) {\n      if (ret && (ret.then || ret.subscribe)) {\n        next(\n          new Error(\n            `[vue-router-plus] can not use next() and (Promise or Observable) together${\n              fn.name ? ' -> ' + fn.name : ''\n            }`\n          )\n        )\n      }\n    } else {\n      if (ret === undefined) {\n        next()\n        return\n      }\n      // process promise\n      if (ret.then) {\n        ret\n          .then(() => {\n            next()\n          })\n          .catch(e => {\n            next(new Error(e))\n          })\n      }\n      // process subscribe\n      if (ret.subscribe) {\n        ret.subscribe(\n          () => {\n            next()\n          },\n          e => {\n            next(new Error(e))\n          }\n        )\n      }\n    }\n    return ret\n  }\n","import { cloneDeep } from '../utils'\nconst queryOptions = to => {\n  if ('_f' in to.query) {\n    delete to.query['_f']\n  }\n  const queryOptions = to.meta.queryOptions\n  const formatedQuery = cloneDeep(to.query)\n  if (queryOptions) {\n    for (let queryName in queryOptions) {\n      const query = queryOptions[queryName]\n      const queryType = query.type\n      const queryDefaultValue = query.default\n      if (queryName in to.query && to.query[queryName] !== undefined) {\n        formatedQuery[queryName] = queryType(to.query[queryName])\n      } else {\n        formatedQuery[queryName] = queryDefaultValue\n      }\n    }\n  }\n  to.meta.query = formatedQuery\n}\n\nexport default queryOptions\n","import VueRouter from 'vue-router'\nimport queryOptions from './before/query-options'\nimport * as utils from './utils'\nlet isHistoryBF = false\n\nclass VueRouterPlus extends VueRouter {\n  static install(Vue) {\n    Vue.use(VueRouter)\n    window.addEventListener('popstate', () => {\n      isHistoryBF = true\n    })\n    Vue.mixin({\n      beforeCreate() {\n        Vue.util.defineReactive(this, '$searchQuery', this.$route.meta.query)\n      },\n      beforeRouteUpdate(to, from, next) {\n        this.$searchQuery = this.$route.meta.query\n        next()\n      }\n    })\n  }\n  constructor(routeOptions) {\n    super(routeOptions)\n\n    this._forceCount = 1\n\n    this.beforeEach(queryOptions)\n  }\n  get isHistoryBF() {\n    return isHistoryBF\n  }\n  beforeEach(fn) {\n    return super.beforeEach(utils.hookWrapper(fn))\n  }\n  beforeResolve(fn) {\n    return super.beforeResolve(utils.hookWrapper(fn))\n  }\n  redirect(redirectLocation, onComplete, onError) {\n    // before vue-router will detect if the replace event is in one tick,so here we add a setTimeout to skip this dectect\n    setTimeout(() => {\n      return this.replace(redirectLocation, onComplete, onError)\n    })\n  }\n  /**\n   * @param {string} mode replace|push\n   * @param {string|object} location\n   * @param {Function} onComplete\n   * @param {Function} onError\n   */\n  _goto(mode, location, onComplete, onError) {\n    isHistoryBF = false\n    // if this is router-link href,just use it,can prevent same url redirect\n    // if (location && location._normalized) {\n    //   return super[mode](location, onComplete, onError)\n    // }\n\n    const { route } = this.resolve(location)\n    const newLocation = {\n      path: route.path,\n      query: Object.assign(route.query, {\n        _f: this._forceCount++\n      }),\n      params: route.params,\n      hash: route.hash\n    }\n    return super[mode](newLocation, onComplete, onError)\n  }\n  push(location, onComplete, onError) {\n    return this._goto('push', location, onComplete, onError)\n  }\n  replace(location, onComplete, onError) {\n    return this._goto('replace', location, onComplete, onError)\n  }\n  // spa reload current Route and force get Data again\n  reload(onComplete, onError) {\n    const current = this.currentRoute\n    this.replace(current.fullPath, onComplete, onError)\n  }\n}\n\nexport const hookWrapper = utils.hookWrapper\nexport default VueRouterPlus\n"],"names":["hookWrapper","fn","to","from","next","ret","call","this","length","then","subscribe","Error","name","undefined","e","queryOptions","query","s","meta","formatedQuery","JSON","parse","stringify","queryName","queryType","type","queryDefaultValue","isHistoryBF","VueRouterPlus","routeOptions","_forceCount","beforeEach","VueRouter","Vue","use","window","addEventListener","mixin","beforeCreate","util","defineReactive","$route","beforeRouteUpdate","$searchQuery","utils","redirectLocation","onComplete","onError","setTimeout","_this2","replace","mode","location","route","resolve","newLocation","path","Object","assign","_f","params","hash","_goto","current","currentRoute","fullPath"],"mappings":";;;6sCAAO,IAEMA,EAAc,SAAAC,UACzB,SAASC,EAAIC,EAAMC,OAEXC,EAAMJ,EAAGK,KAAKC,KAAML,EAAIC,EAAMC,MAEhCH,EAAGO,OAAS,EACVH,IAAQA,EAAII,MAAQJ,EAAIK,YAC1BN,EACE,IAAIO,yFAEAV,EAAGW,KAAO,OAASX,EAAGW,KAAO,UAKhC,SACOC,IAARR,cACFD,IAIEC,EAAII,MACNJ,EACGI,KAAK,WACJL,YAEK,SAAAU,GACLV,EAAK,IAAIO,MAAMG,MAIjBT,EAAIK,WACNL,EAAIK,UACF,WACEN,KAEF,SAAAU,GACEV,EAAK,IAAIO,MAAMG,aAKhBT,IC3CLU,EAAe,SAAAb,GACf,OAAQA,EAAGc,cACNd,EAAGc,MAAH,ODHcC,ECKjBF,EAAeb,EAAGgB,KAAKH,aACvBI,GDNiBF,ECMSf,EAAGc,MDNPI,KAAKC,MAAMD,KAAKE,UAAUL,QCOlDF,MACG,IAAIQ,KAAaR,EAAc,KAC5BC,EAAQD,EAAaQ,GACrBC,EAAYR,EAAMS,KAClBC,EAAoBV,UACtBO,KAAarB,EAAGc,YAAiCH,IAAxBX,EAAGc,MAAMO,GACpCJ,EAAcI,GAAaC,EAAUtB,EAAGc,MAAMO,IAE9CJ,EAAcI,GAAaG,EAIjCxB,EAAGgB,KAAKF,MAAQG,GChBdQ,GAAc,EAEZC;;uBAgBQC,8IACJA,KAEDC,YAAc,IAEdC,WAAWhB,iPArBQiB,2CACXC,GACbA,EAAIC,IAAIF,GACRG,OAAOC,iBAAiB,WAAY,WAClCT,GAAc,IAEhBM,EAAII,MAAM,CACRC,wBACEL,EAAIM,KAAKC,eAAejC,KAAM,eAAgBA,KAAKkC,OAAOvB,KAAKF,QAEjE0B,2BAAkBxC,EAAIC,EAAMC,QACrBuC,aAAepC,KAAKkC,OAAOvB,KAAKF,MACrCZ,iDAcKH,wDACe2C,EAAkB3C,0CAE9BA,2DACe2C,EAAkB3C,qCAEtC4C,EAAkBC,EAAYC,cAErCC,WAAW,kBACFC,EAAKC,QAAQL,EAAkBC,EAAYC;;;;;;uCAShDI,EAAMC,EAAUN,EAAYC,GAChCpB,GAAc,MAMN0B,EAAU9C,KAAK+C,QAAQF,GAAvBC,MACFE,EAAc,CAClBC,KAAMH,EAAMG,KACZxC,MAAOyC,OAAOC,OAAOL,EAAMrC,MAAO,CAChC2C,GAAIpD,KAAKuB,gBAEX8B,OAAQP,EAAMO,OACdC,KAAMR,EAAMQ,8BAEDV,kBAAMI,EAAaT,EAAYC,gCAEzCK,EAAUN,EAAYC,UAClBxC,KAAKuD,MAAM,OAAQV,EAAUN,EAAYC,mCAE1CK,EAAUN,EAAYC,UACrBxC,KAAKuD,MAAM,UAAWV,EAAUN,EAAYC,kCAG9CD,EAAYC,OACXgB,EAAUxD,KAAKyD,kBAChBd,QAAQa,EAAQE,SAAUnB,EAAYC,8CA/CpCpB,WAmDE3B,EAAc4C"}