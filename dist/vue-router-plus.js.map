{"version":3,"file":"vue-router-plus.js","sources":["../src/utils.js","../src/before/query-options.js","../src/vue-router-plus.js"],"sourcesContent":["export const cloneDeep = s => JSON.parse(JSON.stringify(s))\n\nexport const hookWrapper = fn =>\n  function(to, from, next) {\n    // use orginal context\n    const ret = fn.call(this, to, from, next)\n    // 形参大于2个\n    if (fn.length > 2) {\n      if (ret && (ret.then || ret.subscribe)) {\n        next(\n          new Error(\n            `[vue-router-plus] can not use next() and (Promise or Observable) together${\n              fn.name ? ' -> ' + fn.name : ''\n            }`\n          )\n        )\n      }\n    } else {\n      if (ret === undefined) {\n        next()\n        return\n      }\n      // process promise\n      if (ret.then) {\n        ret\n          .then(() => {\n            next()\n          })\n          .catch(e => {\n            next(new Error(e))\n          })\n      }\n      // process subscribe\n      if (ret.subscribe) {\n        ret.subscribe(\n          () => {\n            next()\n          },\n          e => {\n            next(new Error(e))\n          }\n        )\n      }\n    }\n    return ret\n  }\n","import { cloneDeep } from '../utils'\nconst queryOptions = to => {\n  if ('_f' in to.query) {\n    delete to.query['_f']\n  }\n  const queryOptions = to.meta.queryOptions\n  const formatedQuery = cloneDeep(to.query)\n  if (queryOptions) {\n    for (let queryName in queryOptions) {\n      const query = queryOptions[queryName]\n      const queryType = query.type\n      const queryDefaultValue = query.default\n      if (queryName in to.query && to.query[queryName] !== undefined) {\n        formatedQuery[queryName] = queryType(to.query[queryName])\n      } else {\n        formatedQuery[queryName] = queryDefaultValue\n      }\n    }\n  }\n  to.meta.query = formatedQuery\n}\n\nexport default queryOptions\n","import VueRouter from 'vue-router'\nimport queryOptions from './before/query-options'\nimport * as utils from './utils'\nlet isHistoryBF = false\n\nclass VueRouterPlus extends VueRouter {\n  static install(Vue) {\n    Vue.use(VueRouter)\n    window.addEventListener('popstate', () => {\n      isHistoryBF = true\n    })\n    Vue.mixin({\n      beforeCreate() {\n        if (this.$route) {\n          Vue.util.defineReactive(this, '$searchQuery', this.$route.meta.query)\n        }\n      },\n      beforeRouteUpdate(to, from, next) {\n        if (this.$route) {\n          this.$searchQuery = this.$route.meta.query\n        }\n        next()\n      }\n    })\n  }\n  constructor(routeOptions) {\n    super(routeOptions)\n\n    this._forceCount = 1\n    this.from = {}\n    this.to = {}\n\n    this.beforeEach(queryOptions)\n  }\n  get isHistoryBF() {\n    return isHistoryBF\n  }\n  beforeEach(fn) {\n    return super.beforeEach((to, from, next) => {\n      this.from = from\n      this.to = to\n      return hookWrapper(fn)(to, from, next)\n    })\n  }\n  beforeResolve(fn) {\n    return super.beforeResolve(utils.hookWrapper(fn))\n  }\n  redirect(redirectLocation, onComplete, onError) {\n    // shoud call this with return this.router.redirect({...})\n    return Promise.resolve().then(() => {\n      this.replace(redirectLocation, onComplete, onError)\n    })\n  }\n  /**\n   * @param {string} mode replace|push\n   * @param {string|object} location\n   * @param {Function} onComplete\n   * @param {Function} onError\n   */\n  _goto(mode, location, onComplete, onError) {\n    isHistoryBF = false\n    // if this is router-link href,just use it,can prevent same url redirect\n    // if (location && location._normalized) {\n    //   return super[mode](location, onComplete, onError)\n    // }\n\n    const { route } = this.resolve(location)\n    const newLocation = {\n      path: route.path,\n      query: Object.assign(route.query, {\n        _f: this._forceCount++\n      }),\n      params: route.params,\n      hash: route.hash\n    }\n    return super[mode](newLocation, onComplete, onError)\n  }\n  push(location, onComplete, onError) {\n    return this._goto('push', location, onComplete, onError)\n  }\n  replace(location, onComplete, onError) {\n    return this._goto('replace', location, onComplete, onError)\n  }\n  // spa reload current Route and force get Data again\n  reload(onComplete, onError) {\n    const current = this.currentRoute\n    this.replace(current.fullPath, onComplete, onError)\n  }\n}\n\nexport const hookWrapper = utils.hookWrapper\nexport default VueRouterPlus\n"],"names":["hookWrapper","fn","to","from","next","ret","call","this","length","then","subscribe","Error","name","undefined","e","queryOptions","query","s","meta","formatedQuery","JSON","parse","stringify","queryName","queryType","type","queryDefaultValue","isHistoryBF","VueRouterPlus","routeOptions","_forceCount","beforeEach","VueRouter","Vue","use","window","addEventListener","mixin","beforeCreate","$route","util","defineReactive","beforeRouteUpdate","$searchQuery","_this2","utils","redirectLocation","onComplete","onError","Promise","resolve","_this3","replace","mode","location","route","newLocation","path","Object","assign","_f","params","hash","_goto","current","currentRoute","fullPath"],"mappings":";;;6sCAAO,IAEMA,EAAc,SAAAC,UACzB,SAASC,EAAIC,EAAMC,OAEXC,EAAMJ,EAAGK,KAAKC,KAAML,EAAIC,EAAMC,MAEhCH,EAAGO,OAAS,EACVH,IAAQA,EAAII,MAAQJ,EAAIK,YAC1BN,EACE,IAAIO,yFAEAV,EAAGW,KAAO,OAASX,EAAGW,KAAO,UAKhC,SACOC,IAARR,cACFD,IAIEC,EAAII,MACNJ,EACGI,KAAK,WACJL,YAEK,SAAAU,GACLV,EAAK,IAAIO,MAAMG,MAIjBT,EAAIK,WACNL,EAAIK,UACF,WACEN,KAEF,SAAAU,GACEV,EAAK,IAAIO,MAAMG,aAKhBT,IC3CLU,EAAe,SAAAb,GACf,OAAQA,EAAGc,cACNd,EAAGc,MAAH,ODHcC,ECKjBF,EAAeb,EAAGgB,KAAKH,aACvBI,GDNiBF,ECMSf,EAAGc,MDNPI,KAAKC,MAAMD,KAAKE,UAAUL,QCOlDF,MACG,IAAIQ,KAAaR,EAAc,KAC5BC,EAAQD,EAAaQ,GACrBC,EAAYR,EAAMS,KAClBC,EAAoBV,UACtBO,KAAarB,EAAGc,YAAiCH,IAAxBX,EAAGc,MAAMO,GACpCJ,EAAcI,GAAaC,EAAUtB,EAAGc,MAAMO,IAE9CJ,EAAcI,GAAaG,EAIjCxB,EAAGgB,KAAKF,MAAQG,GChBdQ,GAAc,EAEZC;;uBAoBQC,8IACJA,KAEDC,YAAc,IACd3B,KAAO,KACPD,GAAK,KAEL6B,WAAWhB,iPA3BQiB,2CACXC,GACbA,EAAIC,IAAIF,GACRG,OAAOC,iBAAiB,WAAY,WAClCT,GAAc,IAEhBM,EAAII,MAAM,CACRC,wBACM/B,KAAKgC,QACPN,EAAIO,KAAKC,eAAelC,KAAM,eAAgBA,KAAKgC,OAAOrB,KAAKF,QAGnE0B,2BAAkBxC,EAAIC,EAAMC,GACtBG,KAAKgC,cACFI,aAAepC,KAAKgC,OAAOrB,KAAKF,OAEvCZ,iDAgBKH,mEACe,SAACC,EAAIC,EAAMC,UACjCwC,EAAKzC,KAAOA,EACZyC,EAAK1C,GAAKA,EACHF,EAAYC,EAAZD,CAAgBE,EAAIC,EAAMC,2CAGvBH,2DACe4C,EAAkB5C,qCAEtC6C,EAAkBC,EAAYC,qBAE9BC,QAAQC,UAAUzC,KAAK,WAC5B0C,EAAKC,QAAQN,EAAkBC,EAAYC;;;;;;uCASzCK,EAAMC,EAAUP,EAAYC,GAChCrB,GAAc,MAMN4B,EAAUhD,KAAK2C,QAAQI,GAAvBC,MACFC,EAAc,CAClBC,KAAMF,EAAME,KACZzC,MAAO0C,OAAOC,OAAOJ,EAAMvC,MAAO,CAChC4C,GAAIrD,KAAKuB,gBAEX+B,OAAQN,EAAMM,OACdC,KAAMP,EAAMO,8BAEDT,kBAAMG,EAAaT,EAAYC,gCAEzCM,EAAUP,EAAYC,UAClBzC,KAAKwD,MAAM,OAAQT,EAAUP,EAAYC,mCAE1CM,EAAUP,EAAYC,UACrBzC,KAAKwD,MAAM,UAAWT,EAAUP,EAAYC,kCAG9CD,EAAYC,OACXgB,EAAUzD,KAAK0D,kBAChBb,QAAQY,EAAQE,SAAUnB,EAAYC,8CAnDpCrB,WAuDE3B,EAAc6C"}